<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
	<link rel="stylesheet" th:href="@{/Assets/Admin/css/main.css}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/boxicons@latest/css/boxicons.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <title>Sách</title>
    <th:block th:replace="fragments/header :: header"></th:block>
</head>
<body class="app sidebar-mini rtl">

<div th:replace="fragments/sidebar :: sidebar"></div>

<main class="app-content">
<form th:action="@{/admin/sach/create}" method="post" enctype="multipart/form-data" th:object="${book}">
    <div class="form-horizontal">
        <hr />
        <div class="row">
            <div class="col-md-12">
                <div class="tile">
                    <h3 class="tile-title">Tạo mới sản phẩm</h3>
                    <div class="tile-body">
                        <div class="row">
                            <div class="form-group col-md-4">
                                <label>Tên sản phẩm</label>
                                <input type="text" th:field="*{bookName}" class="form-control" />
                                <div class="text-danger" th:if="${#fields.hasErrors('bookName')}" th:errors="*{bookName}"></div>
                            </div>

                            <div class="form-group col-md-4">
                                <label>Số lượng</label>
                                <input type="number" th:field="*{quantity}" class="form-control" />
                                <div class="text-danger" th:errors="*{quantity}"></div>
                            </div>

                            <div class="form-group col-md-4">
                                <label>Thể loại</label>
                                <select th:field="*{category.idCategory}" class="form-control">
                                    <option th:each="cat : ${categories}" th:value="${cat.idCategory}" th:text="${cat.categoryName}"></option>
                                </select>
                            </div>
							<div class="form-group col-md-8">
                                <label>Tác giả</label>
                                <select name="author"id="authorSelect" class="form-control">
                                    <option th:each="auth : ${authors}" th:value="${auth.idAuthor}" th:text="${auth.authorName}"></option>
                                </select>
                                <div class="mt-2">
								    <p id="selectedAuthorsDisplay"></p>
								</div>
								<input type="hidden" name="authorIds" id="authorIds" />
                            </div>
                            <div class="form-group col-md-4">
                                <label>Đơn giá</label>
                                <input type="text" th:field="*{price}" class="form-control" />
                            </div>
							<div class="form-group col-md-4">
                                <label>Ảnh sản phẩm</label>
                                <input type="file" name="file" class="form-control" onchange="previewImage(event)" />
                                <img id="thumbimage" style="display:none; max-width: 100%; margin-top: 10px;" />
                            </div>
                            <div class="form-group col-md-6">
                                <label>Mô tả</label>
                                <textarea th:field="*{description}" class="form-control"></textarea>
                            </div>

                            
                        </div>
                    </div>
                    <button type="submit" class="btn btn-save">Tạo sản phẩm</button>
                    <a class="btn btn-cancel" th:href="@{/admin/sach}">Hủy bỏ</a>
                </div>
            </div>
        </div>
    </div>
</form>

<script>
    function previewImage(event) {
        const reader = new FileReader();
        reader.onload = function (e) {
            const img = document.getElementById("thumbimage");
            img.src = e.target.result;
            img.style.display = "block";
        }
        reader.readAsDataURL(event.target.files[0]);
    }
    const selectedAuthors = new Map(); // Key: ID, Value: Tên
    const selectBox = document.getElementById("authorSelect");
    const display = document.getElementById("selectedAuthorsDisplay");
    const hiddenInput = document.getElementById("authorIds");

    selectBox.addEventListener("change", function () {
        const selectedOption = this.options[this.selectedIndex];
        const id = selectedOption.value;
        const name = selectedOption.text;

        // Nếu đã chọn thì bỏ chọn
        if (selectedAuthors.has(id)) {
            selectedAuthors.delete(id);
        } else {
            selectedAuthors.set(id, name);
        }

        // Cập nhật UI
        display.innerText = Array.from(selectedAuthors.values()).join(", ");
        hiddenInput.value = Array.from(selectedAuthors.keys()).join(",");
    });
</script>
</main>

<div th:replace="fragments/script :: scripts"></div>

</body>
</html>